version: '3'
services:
  app:
    tty: true
    stdin_open: true
    build: .
    volumes:
      - .:/var/app
      - /var/app/vendor
    ports:
      - '3000:3000'
  db:
    image: mysql:8
    environment:
      MYSQL_ROOT_PASSWORD: password
      TZ: Asia/Tokyo
    ports:
      - '3306:3306'
    command: --default-authentication-plugin=mysql_native_password
    volumes:
      - mysql_data:/var/lib/mysql
  node:
    image: node:10.17.0-alpine
    environment:
      WEBPACKER_DEV_SERVER_HOST: 0.0.0.0
    volumes:
      - .:/var/app:cached
      - /var/app/frontend/node_modules
    working_dir: /var/app/frontend
    ports:
      - '8081:8081'
    command: [sh, -c, yarn && yarn dev]

volumes:
  mysql_data:
